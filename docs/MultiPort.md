
# مقدمه

مالتی پورت یعنی اینکه روی سرور ایران کاربر به هرپورتی که وصل شد ؛‌ به همون پورت روی سرور خارج وصل بشه.

اولین نکته اینه که این برنامه رو مثل قبل میتونید حالت تک پورت بکار بگیرید و استفاده کنید بدون مشکل پس با خیال راحت اپدیت کنید.

هم در سرور ایران هم در سرور خارج اول برنامه را اپدیت کنید تا بتوانید از این قابلیت استفاده کنید

برای استفاده از قابلیت مالتی پورت لطفا توضیحات را کامل بخونید و رد نکنید.




برای اجرا به صورت مالتی پورت در سرور ایران اینگونه عمل کنید

> ./RTT --iran  --lport:23-65535  --sni:splus.ir --password:123


مشخصه که بازه پورتی که میخواهید برنامه گوش بده و فوروارد کنه رو در lport قرار میدین ؛ حواستون باشه پورت ssh که باهاش به سرور ایران وصل شدین توی این بازه نباشه وگرنه قطع میشین .

همچنین میتوانید به این بازه پورت هایی را جداگانه اضافه کنید ؛ به ازای هر پورتی که میخواید اضافه کنید --add-port:N را به دستور اضافه کنید 




توصیه میکنم  که پورت ۴۴۳ داخل این بازه باشه دلیلشو جولو تر میگم.

روی سرور ایران باید برنامه iptables نصب باشه  وگرنه برنامه ارور میده ؛ دقت کنید برنامه فقط برای جمع کردن دیتا از پورت های دیگه به iptables نیاز داره و iptables در فرایند تونل و انتقال دیتا هیچ نقشی نداره.

و به همین علت برای استفاده از مالتی پورت باید سرور ایرانتون لینکوسی باشه که روش iptable نصب بشه ولی سرور خارج میتونه هر سیستم عاملی از جمله ویندوز هم باشه با مالتی پورت چون اونجا iptable نیاز نیست.



خوب حالا باید در سرور خارج دستور رو به این شکل اجرا کنید 

> ./RTT --kharej --iran-ip:5.4.3.2 --iran-port:443 --toip:127.0.0.1 --toport:multiport --password:123 --sni:splus.ir

اولین نکته اینجاست داخل --iran-port

اینجا باید یک پورت وارد کنید که داخل بازه ی پورتی که توی دستور سرور ایران مشخص کرده بودین باشه ؛ برای همین گفتم اونجا ۴۴۳ رو بزارین تا اینجا بتونین به ۴۴۳ ایران وصل بشه و دیتا هارو دریافت کنه ؛ همه دیتا ها از پورت ۴۴۳ سرور ایران دریافت میشه و وقتی به سرور خارج رسید تفکیک میشه به پورت مقصد .


نکته دوم هم --to-port هست که اگه قابلیت مالتی پورت میخواین باید مقدار multiport قرار بدین.



و در آخر این که اگه روی سرور ایران برنامه رو به شکل مالتی پورت اجرا کردین رو سرور خارج هم باید مالتی پورت اجرا کرده باشین ؛ نمیشه یه جا مالتی پورت اجرا کرد یه جا دیگه تک پورت چون بی معنی میشه 

***

2 نکته مهم
در سرور ایران چون برنامه ایپی تیبل رو تنظیم میکنه ؛ اگه برنامه رو کیل کنید شاید نتونه ایپی تیبل رو ریست کنه و رول هاشو پاک کنه در نتیجه پورت های مالتی پورت توسط ایپی تیبل اشغال خواهند بود پس با این دستورات محض اطمینان ریست کنید 

```sh
iptables -t nat -F
iptables -t nat -X

ip6tables -t nat -F
ip6tables -t nat -X
```

و اینکه شاید شما نخواهید که برنامه در هنگام شروع و پایان رول های آیپی تیبل رو پاک کنه ؛ در این صورت این سوییچ رو در دستور سرور ایران باید بزنید

> --keep-iptables

که به هیچ وجه پیشناهاد نمی کنم چنین کاری انجام بدین چون اونوقت خودتون باید کامل حواستون به رول ها باشه و هربار که برنامه بسته شد رول های قبلیشو پاک کنید ؛ لطفا اگه کاملا متوجه این مورد هستین و نیاز بلاجبار هست از این سوییچ استفاده کنید.
